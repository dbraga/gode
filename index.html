<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Gode</title>
  </head>
  <body>


  <script type="text/javascript" src="media/jquery-1.8.3.min.js"></script>
  <script src="media/d3.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>


  <script>
    var socket = io.connect('http://localhost:3000');

    socket.on('full-git-log', function (full_git_log) {
      var dataset = full_git_log;
      node_radius = 30;

      d3.select("body").append("svg:svg").attr("width", 1000).attr("height", 1000);
      d3.select("body svg").selectAll("circle")
          .data(dataset)
          .enter()
          .append("circle").attr("r", node_radius).attr("cy", function(d){ return d.index * 100 + 150;}).attr("cx", 300).style("fill", "steelblue")
    });


    socket.on('test', function (dataset) {
      var svg = d3.select("body svg") ;


          //move down circles
          var first_node_current_cy = d3.select("body svg").select("circle")[0][0].cy.baseVal.value;
          var first_node_current_cx = d3.select("body svg").select("circle")[0][0].cx.baseVal.value;
          var circle = svg.selectAll("circle");
          circle.transition()
            .duration(500) // this is 1s
            .delay(100)     // this is 0.1s   
          .attr("cy", function(d, i) {
              return first_node_current_cy + i * 100  + 200;        
          });


      var circle = svg.selectAll("circle")
        .data(dataset);


      circle.enter().append("circle")
          .attr("r", 30);

      circle
          .attr("cx", function(d) { return 300; })
          .attr("cy", function(d) { return d.index * 100 + 150;; });

      circle.transition().duration(1000) // this is 1s
        .delay(2000)     // this is 0.1s
        .filter(function(d, i) { if (i==0) return 1; }).style("fill", "green")
        .each("end",function() { 
          d3.select("body svg").selectAll("circle")       
            .transition()
            .duration(1000) // this is 1s
            .delay(100)     // this is 0.1s   
            .style("fill", "steelblue")
            .attr("cy", function(d, i) {
              return first_node_current_cy + i * 100 ;        
          }).filter(function(d, i) { return 1; });
         });

      circle.exit().remove();

    });


  </script>
  </body>
</html>